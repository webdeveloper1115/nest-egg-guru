function couponDelete(e){e.preventDefault(),$("#hidden-coupon").remove(),$(".coupon-message-success").remove(),$("#coupon-id").remove();$(this).data("coupon-id");$.ajax({url:"/checkout/coupon-delete",type:"DELETE",success:function(e){removeElements()}})}function successMessage(e,o){o.after($("<div/>").attr("id","coupon-message").addClass("coupon-message-success").text("Success! Your coupon code works."));var t=document.getElementById("coupon-message"),n=$("<a/>").attr("href","javascript:void(0)").addClass("coupon-delete").text("X").data("coupon-id",e.id).click(couponDelete);$(t).after($("<div/>").attr("id","coupon-id").append($("<span/>").addClass("coupon-id-show").text(e.id).append(n)))}function removeElements(){$("#coupon-message").remove(),$("#coupon-id-confirm").remove(),$("#discount-message").remove(),$("#hidden-coupon").remove(),$("#coupon-id").remove(),$("#coupon-code").removeClass("coupon-input-failure")}function failureMessage(e){e.after($("<div/>").attr("id","coupon-message").addClass("coupon-message-failure").text("Oops! This coupon is not valid.")),$("#coupon-code").addClass("coupon-input-failure")}function stripeResponseHandler(e,o){var t=$("#payment-form");if(o.error)$(".payment-errors").text(o.error.message),$("#payment-submit").prop("disabled",!1);else{var n=o.id;t.append($('<input type="hidden" name="stripeToken" />').val(n)),t.get(0).submit()}}Stripe.setPublishableKey("pk_test_iHQhSRPF2xvoLmhXNpqVfE8m"),$("#credit-card-number").blur(function(){var e=$(this).val().toString();$("#credit-card-4").val(e.substr(e.length-4))}),$(function(){$("#payment-form").submit(function(e){var o=$(this);return o.valid()?($("#payment-submit").prop("disabled",!0),""!==$("#calculator-choice").val()?(Stripe.card.createToken(o,stripeResponseHandler),!1):($(".payment-errors").text("You must select a product."),$("#payment-submit").prop("disabled",!1),!1)):void 0}),$("#account-form").submit(function(e){return!0}),$("a.coupon-delete").click(couponDelete),$("#coupon-code-button").click(function(e){e.preventDefault(),$(this).prop("disabled",!0),removeElements();var o=$("#coupon-code-row"),t=$("#coupon-code").val();$.post("/checkout/check-coupon",{couponCode:t},function(e){if(e.id){successMessage(e,o);var t=JSON.stringify(e);$("#payment-form").append($('<input type="hidden" id="hidden-coupon" name="coupon" />').val(t)),$("#coupon-code-button").prop("disabled",!1)}else failureMessage(o),$("#coupon-code-button").prop("disabled",!1)})})});